@using Climb.Services
@using Climb.ViewModels
@model LeagueHomeViewModel
@inject CdnService cdnService
@inject ILeagueUserService leagueUserService

@{
    ViewData["Title"] = Model.league.Name;
    Layout = "_HomeLayout";
    var returnUrl = Url.Action("Home", "Leagues", new
    {
        Model.league.ID
    });
}

@section Styles {
    <link href="/css/league_home.css" rel="Stylesheet" type="text/css" />
    <link href="/css/leagueuser/powerrank.css" type="text/css" rel="stylesheet" />
}

@section Body_Banner {
    <img class="body-banner-image" src="@Model.league.Game.BannerPicUrl" />
    <h1 class="body-banner-title">@Model.league.Name</h1>
}

@section Body_Subnavbar {
    <a asp-action="Home" asp-route-id="@Model.league.ID">Home</a>
    <a asp-action="PowerRanks" asp-route-id="@Model.league.ID">Power Ranks</a>
    <a href="#">Seasons</a>
}

<div id="homepage">
    @Html.Raw(Model.league.HomePage)
</div>

<div id="editor" hidden="true">
    <form id="editor-form" asp-controller="Leagues" asp-action="Update">
        <input type="hidden" asp-for="@Model.league.ID"/>

        <textarea id="editor-input" asp-for="@Model.league.HomePage" onchange="editorUpdate()" form="editor-form">
            @Model.league.HomePage
        </textarea>
        <button type="button" onclick="updateHomePage()">Save</button>
    </form>
</div>

@if (Model.isAdmin)
{
    <button onclick="toggleEditor()">Edit Home Page</button>
}

@section User_Content_Left
{}

@section User_Content_Middle
{}

@section User_Content_Right
{}

@section Scripts {
    <script type="text/javascript">
        function toggleEditor() {
            var enabled = $("#editor").attr("hidden");
            $("#editor").attr("hidden", !enabled);
        }

        function editorUpdate() {
            var editor = $("#editor-input").val();
            $("#homepage").html(editor);
        }

        function updateHomePage() {
            var form = $("#editor-form");
            $.post({
                url: "/Leagues/Update",
                data: form.serialize(),
                success: () => {
                    location.reload();
                },
                error: function (response) {
                    alert("Can't update league home page.\n" + response.responseText);
                }
            });
        }
    </script>
}
